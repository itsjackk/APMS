<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin Projects Management - APMS">

    <!-- Cache Control Meta Tags -->
    <meta http-equiv="Cache-Control" content="public, max-age=3600, must-revalidate">
    <meta http-equiv="Pragma" content="cache">

    <title>Manage Projects | APMS</title>

    <!-- DNS Prefetch & Preconnect -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" as="style" crossorigin>
    <link rel="preload" th:href="@{/css/admin-projects.css}" as="style">
    <link rel="preload" th:href="@{/css/snowflakes.css}" as="style">

    <!-- Critical CSS - Load immediately -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/admin-projects.css}">
    <link rel="stylesheet" th:href="@{/css/snowflakes.css}">

    <!-- Non-critical CSS - Defer loading -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style"
          onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </noscript>

    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&display=swap"
          as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&display=swap"
              rel="stylesheet">
    </noscript>

    <!-- Preload JavaScript -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" as="script">
    <link rel="preload" th:href="@{/js/auth-utils.js}" as="script">
    <link rel="preload" th:href="@{/js/visual-effects.js}" as="script">
    <link rel="preload" th:href="@{/js/admin-projects.js}" as="script">
</head>
<body>
<div id="snowflakes" aria-hidden="true"></div>

<!--<div class="christmas-tree" aria-hidden="true">ðŸŽ„</div>-->

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-3 col-lg-2 sidebar p-0" role="navigation" aria-label="Main navigation">
            <div class="p-3">
                <h4 class="text-center mb-4">
                    <button class="btn btn-sm snowflake-toggle" id="snowflakeToggle" title="Toggle Snowflakes">
                        <i class="fas fa-snowflake"></i>
                    </button>
                    <i class="fas fa-project-diagram" aria-hidden="true"></i> APMS
                </h4>
                <div class="nav flex-column">
                    <a class="nav-link" href="/ConsoleApp/dashboard">
                        <i class="fas fa-tachometer-alt me-2" aria-hidden="true"></i> Dashboard
                    </a>
                    <a class="nav-link" href="/ConsoleApp/projects">
                        <i class="fas fa-folder me-2" aria-hidden="true"></i> My Projects
                    </a>
                    <a class="nav-link" href="/ConsoleApp/projects/create">
                        <i class="fas fa-plus me-2" aria-hidden="true"></i> Create Project
                    </a>
                    <hr>
                    <small class="text-muted px-3">ADMIN</small>
                    <a class="nav-link active" href="/ConsoleApp/admin/projects" aria-current="page">
                        <i class="fas fa-cogs me-2" aria-hidden="true"></i> Manage Projects
                    </a>
                    <a class="nav-link" href="/ConsoleApp/admin/users">
                        <i class="fas fa-users me-2" aria-hidden="true"></i> Manage Users
                    </a>
                    <hr>
                    <a class="nav-link" href="/ConsoleApp/profile">
                        <i class="fas fa-user me-2" aria-hidden="true"></i> Profile
                    </a>
                    <a class="nav-link text-danger logout-link" href="#" onclick="logout(); return false;">
                        <i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i> Logout
                    </a>
                </div>
            </div>
        </nav>

        <main class="main-content-wrapper" role="main">
            <div class="main-content">
                <header class="page-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="h2">
                            <i class="fas fa-shield-alt me-2" aria-hidden="true"></i>Admin - Manage Projects
                        </h1>
                        <div>
                            <a href="/ConsoleApp/dashboard" class="btn btn-outline-christmas">
                                <i class="fas fa-arrow-left me-2" aria-hidden="true"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </header>

                <section id="statsContainer" class="row mb-4" aria-label="Project statistics">
                    <div class="col-md-12 text-center">
                        <div class="loading-spinner" role="status" aria-label="Loading statistics"></div>
                        <p class="text-white mt-2">Loading statistics...</p>
                    </div>
                </section>

                <section class="filter-section" aria-label="Project filters">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="statusFilter" class="form-label">Filter by Status</label>
                            <select class="form-select" id="statusFilter" onchange="filterProjects()"
                                    aria-label="Filter projects by status">
                                <option value="">All Statuses</option>
                                <option value="PLANNING">Planning</option>
                                <option value="IN_PROGRESS">In Progress</option>
                                <option value="ON_HOLD">On Hold</option>
                                <option value="COMPLETED">Completed</option>
                                <option value="CANCELLED">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="priorityFilter" class="form-label">Filter by Priority</label>
                            <select class="form-select" id="priorityFilter" onchange="filterProjects()"
                                    aria-label="Filter projects by priority">
                                <option value="">All Priorities</option>
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                                <option value="CRITICAL">Critical</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="typeFilter" class="form-label">Filter by Type</label>
                            <select class="form-select" id="typeFilter" onchange="filterProjects()"
                                    aria-label="Filter projects by type">
                                <option value="">All Types</option>
                                <option value="global">Global</option>
                                <option value="personal">Personal</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="sortBy" class="form-label">Sort By</label>
                            <select class="form-select" id="sortBy" onchange="sortProjects()"
                                    aria-label="Sort projects">
                                <option value="name">Name</option>
                                <option value="createdAt">Created Date</option>
                                <option value="progress">Progress</option>
                                <option value="priority">Priority</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>
                </section>

                <section id="projectsList" aria-label="Projects list">
                    <div class="text-center">
                        <div class="loading-spinner" role="status" aria-label="Loading projects"></div>
                        <p class="text-white mt-2">Loading projects...</p>
                    </div>
                </section>

                <footer class="footer">
                    <p>Happy New Year! âœ¨</p>
                </footer>
            </div>
        </main>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancel"></button>
            </div>
            <div class="modal-body">
                <form id="editProjectForm">
                    <input type="hidden" id="editProjectId">
                    <div class="mb-3">
                        <label for="editProjectName" class="form-label">Project Name</label>
                        <input type="text" class="form-control" id="editProjectName" required aria-required="true">
                    </div>
                    <div class="mb-3">
                        <label for="editProjectDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editProjectDescription" rows="3"
                                  aria-label="Project description" maxlength="500"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editProjectStatus" class="form-label">Status</label>
                                <select class="form-select" id="editProjectStatus" required>
                                    <option value="PLANNING">Planning</option>
                                    <option value="IN_PROGRESS">In Progress</option>
                                    <option value="ON_HOLD">On Hold</option>
                                    <option value="COMPLETED">Completed</option>
                                    <option value="CANCELLED">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editProjectPriority" class="form-label">Priority</label>
                                <select class="form-select" id="editProjectPriority" required>
                                    <option value="LOW">Low</option>
                                    <option value="MEDIUM">Medium</option>
                                    <option value="HIGH">High</option>
                                    <option value="CRITICAL">Critical</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editProjectType" class="form-label">Type</label>
                                <select class="form-select" id="editProjectType" required>
                                    <option value="personal">Personal</option>
                                    <option value="global">Global</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editProjectProgress" class="form-label">Progress (%)</label>
                                <input type="number" class="form-control" id="editProjectProgress" min="0" max="100"
                                       required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3" id="editAssignUserSection" style="display: none;">
                        <label for="editAssignedUser" class="form-label">Assign to User</label>
                        <select class="form-select" id="editAssignedUser">
                            <option value="">Not assigned</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Owner</label>
                                <input type="text" class="form-control" id="editProjectOwner" disabled>
                                <small class="text-muted">Project owner cannot be changed</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editProjectEndDate" class="form-label">
                                    <i class="fas fa-calendar-check me-2" aria-hidden="true"></i>End Date
                                </label>
                                <input type="date" class="form-control" id="editProjectEndDate" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveProjectChanges()">
                    <i class="fas fa-save me-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script th:src="@{/js/auth-utils.js}" defer></script>
<script th:src="@{/js/visual-effects.js}" defer></script>
<script th:src="@{/js/admin-projects.js}" defer></script>
</body>
</html>